{% extends "base.html" %}

{% block title %}加入团队 - 雁翎CTF平台{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h4><i class="fas fa-users"></i> 加入团队</h4>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">您可以通过团队ID或邀请码申请加入团队。</p>
                    
                    <!-- 选择加入方式 -->
                    <div class="mb-4">
                        <div class="btn-group w-100" role="group" aria-label="加入方式选择">
                            <input type="radio" class="btn-check" name="join_method" id="join_by_id" value="id" checked>
                            <label class="btn btn-outline-primary" for="join_by_id">
                                <i class="fas fa-hashtag"></i> 通过团队ID
                            </label>
                            
                            <input type="radio" class="btn-check" name="join_method" id="join_by_code" value="code">
                            <label class="btn btn-outline-primary" for="join_by_code">
                                <i class="fas fa-key"></i> 通过邀请码
                            </label>
                        </div>
                    </div>
                    
                    <form method="POST" action="{{ url_for('teams.join_request') }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <!-- 团队ID输入 -->
                        <div class="mb-3" id="team_id_section">
                            <label for="team_id" class="form-label">团队ID</label>
                            <input type="number" class="form-control" id="team_id" name="team_id" 
                                   placeholder="请输入要加入的团队ID" min="1">
                            <div class="form-text">请向团队队长询问团队ID</div>
                        </div>
                        
                        <!-- 邀请码输入 -->
                        <div class="mb-3 d-none" id="invite_code_section">
                            <label for="invite_code" class="form-label">邀请码</label>
                            <input type="text" class="form-control" id="invite_code" name="invite_code" 
                                   placeholder="请输入8位邀请码" maxlength="8" style="text-transform: uppercase;">
                            <div class="form-text">请输入队长提供的邀请码</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="message" class="form-label">申请理由 <span class="text-muted">(可选)</span></label>
                            <textarea class="form-control" id="message" name="message" rows="3" 
                                      placeholder="简单介绍一下自己，说明为什么想加入这个团队..."></textarea>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('teams.index') }}" class="btn btn-secondary me-md-2">浏览团队</a>
                            <a href="{{ url_for('teams.create') }}" class="btn btn-outline-primary me-md-2">创建团队</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> 发送申请
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 团队列表预览 -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="fas fa-list"></i> 活跃团队</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">以下是一些活跃的团队，您可以参考他们的团队ID：</p>
                    <div class="row">
                        {% if teams %}
                            {% for team in teams[:6] %}
                            <div class="col-md-6 mb-3">
                                <div class="card border-light">
                                    <div class="card-body py-2">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong>{{ team.name }}</strong>
                                                <small class="text-muted d-block">ID: {{ team.id }}</small>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">{{ team.member_count }}/{{ team.max_members }}人</small>
                                                <div class="text-primary">{{ team.score }}分</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-12">
                                <div class="text-center text-muted">
                                    <i class="fas fa-users fa-2x mb-2"></i>
                                    <p>暂无活跃团队</p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="text-center mt-3">
                        <a href="{{ url_for('teams.index') }}" class="btn btn-outline-primary btn-sm">
                            查看所有团队 <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.card-header h4 {
    margin: 0;
    color: #495057;
}

.form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.btn-check:checked + .btn-outline-primary {
    background-color: #007bff;
    border-color: #007bff;
    color: white;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const joinByIdRadio = document.getElementById('join_by_id');
    const joinByCodeRadio = document.getElementById('join_by_code');
    const teamIdSection = document.getElementById('team_id_section');
    const inviteCodeSection = document.getElementById('invite_code_section');
    const teamIdInput = document.getElementById('team_id');
    const inviteCodeInput = document.getElementById('invite_code');
    
    function toggleSections() {
        if (joinByIdRadio.checked) {
            teamIdSection.classList.remove('d-none');
            inviteCodeSection.classList.add('d-none');
            teamIdInput.required = true;
            inviteCodeInput.required = false;
            inviteCodeInput.value = '';
        } else {
            teamIdSection.classList.add('d-none');
            inviteCodeSection.classList.remove('d-none');
            teamIdInput.required = false;
            inviteCodeInput.required = true;
            teamIdInput.value = '';
        }
    }
    
    joinByIdRadio.addEventListener('change', toggleSections);
    joinByCodeRadio.addEventListener('change', toggleSections);
    
    // 邀请码自动转大写
    inviteCodeInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase();
    });
});
</script>
{% endblock %}